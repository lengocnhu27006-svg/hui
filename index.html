<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Quáº£n LÃ½ Há»¥i</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- ICON APP -->
<link rel="apple-touch-icon" sizes="180x180" href="icon.png">
<link rel="icon" type="image/png" sizes="512x512" href="app-icon.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="Quáº£n LÃ½ Há»¥i">

<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>

.chu-hui{
    text-align:center;
    font-size:20px;   /* TO HÆ N */
    font-weight:700;  /* Äáº¬M */
    margin-bottom:20px;
    color:#222;
}
body{font-family:Arial;background:#f4f6f8;padding:20px;margin:0}

/* HOME */
#home .logo{ text-align:center; font-size:24px; font-weight:bold; margin:16px 0 20px; }
.hui-card-btn{
    display:flex; align-items:center; background:#fff; border-radius:12px; padding:10px;
    margin-bottom:14px; box-shadow:0 3px 8px rgba(0,0,0,.15); cursor:pointer;
}
.hui-card-btn img{ width:60px; height:60px; border-radius:10px; object-fit:cover; margin-right:12px; }
.hui-card-btn span{ font-size:18px; font-weight:bold; }

/* APP */
#app{ display:none; }
button{ padding:6px 10px; border:none; border-radius:4px; cursor:pointer; margin:4px; font-weight:bold;}
button.them{ background:#27ae60; color:#fff; }
button.hot{ background:#f39c12; color:#fff; }
button.xoa{ background:#c0392b; color:#fff; }
button.ky{ background:#8e44ad; color:#fff; }

table{ width:100%; border-collapse:collapse; margin-top:10px; background:#fff; }
th, td{ border:1px solid #ccc; padding:8px; text-align:center; }
th{ background:#3498db; color:#fff; }
input[type="text"]{ width:100%; border:none; background:transparent; text-align:center; font-weight:bold; font-size:16px; }

.info{background:#fff;padding:10px;border-radius:6px;margin-bottom:10px}
.tongHot{margin-top:10px;font-size:16px;font-weight:bold}
</style>
</head>
<body>

<!-- HOME -->
<div id="home">
    <div class="logo">ğŸ“’ QUáº¢N LÃ Há»¤I</div>
    <div class="chu-hui">ğŸ‘¤ Chá»§ há»¥i: Nguyá»…n Háº±ng Ni</div>

    <div class="hui-card-btn" onclick="openHui(5000000)">
        <img src="hui5.png" alt="Há»¥i 5 triá»‡u">
        <span>Há»¥i 5tr / 1 thÃ¡ng DÃ¢y 1</span>
    </div>

    <div class="hui-card-btn" onclick="openHui(10000000)">
        <img src="hui10.png" alt="Há»¥i 10 triá»‡u">
        <span>Há»¥i 10tr / 1 thÃ¡ng DÃ¢y 1</span>
    </div>

    <div class="hui-card-btn" onclick="openHui(20000000)">
        <img src="hui20.png" alt="Há»¥i 20 triá»‡u">
        <span>Há»¥i 20tr / 1 thÃ¡ng DÃ¢y 1</span>
    </div>
</div>

<!-- APP -->
<div id="app">
    <button class="ky" onclick="goHome()">â¬… Quay vá»</button>

    <div class="info">
        <b>Ká»³:</b>
        <button class="ky" onclick="doiKy(-1)">â¬…</button>
        <input type="number" id="ky" value="1" onchange="capNhatKy()">
        <button class="ky" onclick="doiKy(1)">â¡</button>
        &nbsp;&nbsp;
        <b>NgÃ y khui:</b>
        <input type="date" id="ngayKhui" onchange="capNhatNgay()">
    </div>

    <button class="them" onclick="themNguoi()">â• ThÃªm ngÆ°á»i</button>
    <button class="ky" onclick="xuatPDF()">ğŸ“¤ Xuáº¥t PDF gá»­i Zalo</button>
    <button class="xoa" onclick="resetHui()">â™» Reset dÃ¢y há»¥i</button>

    <table>
        <thead>
            <tr>
                <th>TÃªn</th>
                <th>ÄÃ£ Ä‘Ã³ng</th>
                <th>Tiá»n Ä‘Ã³ng</th>
                <th>Bá» thÄƒm</th>
                <th>Há»‘t</th>
                <th>XoÃ¡</th>
            </tr>
        </thead>
        <tbody id="bang"></tbody>
    </table>

    <div class="tongHot" id="tongHot"></div>
</div>

<script>
let currentMoney = 0;
const DAU_THAO = 10000000;
let huiData = JSON.parse(localStorage.getItem("huiAppData")||"{}");

function save(){ localStorage.setItem("huiAppData", JSON.stringify(huiData)); }
function goHome(){ document.getElementById("app").style.display="none"; document.getElementById("home").style.display="block"; }

function openHui(money){
    currentMoney = money;
    if(!huiData[money]) huiData[money] = { ky:1, ngay:{}, tongHot:{}, danhSach:[] };
    document.getElementById("home").style.display="none";
    document.getElementById("app").style.display="block";
    render();
}

function capNhatKy(){ huiData[currentMoney].ky = parseInt(ky.value)||1; save(); render(); }
function doiKy(s){ huiData[currentMoney].ky += s; if(huiData[currentMoney].ky<1) huiData[currentMoney].ky=1; ky.value=huiData[currentMoney].ky; save(); render(); }
function capNhatNgay(){ huiData[currentMoney].ngay[huiData[currentMoney].ky] = ngayKhui.value; save(); }

function themNguoi(){ huiData[currentMoney].danhSach.push({ten:"NgÆ°á»i "+(huiData[currentMoney].danhSach.length+1),lichSu:{}}); save(); render(); }
function daChet(n){ let ky=huiData[currentMoney].ky; for(let k in n.lichSu) if(Number(k)<ky && n.lichSu[k].daHot) return true; return false; }
function tickDong(i){ let ls=huiData[currentMoney].danhSach[i].lichSu[huiData[currentMoney].ky]; if(ls){ ls.daDong=!ls.daDong; save(); render(); } }

function hotHui(i){
    let ky=huiData[currentMoney].ky;
    let bo=parseInt(prompt("Nháº­p tiá»n bá» thÄƒm:"))||0;
    huiData[currentMoney].danhSach.forEach(n=>{ if(!n.lichSu[ky]) n.lichSu[ky]={dong:currentMoney, daDong:false, daHot:false, boTham:0}; });
    huiData[currentMoney].danhSach[i].lichSu[ky].daHot=true;
    huiData[currentMoney].danhSach[i].lichSu[ky].dong=0;
    huiData[currentMoney].danhSach[i].lichSu[ky].boTham=bo;
    let tong=0;
    huiData[currentMoney].danhSach.forEach((n,idx)=>{
        if(idx!==i){ n.lichSu[ky].dong = !daChet(n)? currentMoney-bo : currentMoney; tong += n.lichSu[ky].dong; }
    });
    huiData[currentMoney].tongHot[ky]=tong;
    alert("ğŸ’° Há»‘t Ä‘Æ°á»£c "+tong.toLocaleString()+" Ä‘");
    save(); render();
}

function xoaNguoi(i){ huiData[currentMoney].danhSach.splice(i,1); save(); render(); }

function veBang(){
    let kyHienTai=huiData[currentMoney].ky;
    ky.value=kyHienTai;
    ngayKhui.value=huiData[currentMoney].ngay[kyHienTai]||"";

    let html="";
    huiData[currentMoney].danhSach.forEach((n,i)=>{
        let ls=n.lichSu[kyHienTai];
        html+=`<tr>
<td><input type="text" value="${n.ten}" oninput="huiData[currentMoney].danhSach[${i}].ten=this.value;save()"></td>
<td onclick="tickDong(${i})" style="cursor:pointer">${ls?.daDong?"âœ”":""}</td>
<td>${ls?ls.dong.toLocaleString()+" Ä‘":""}</td>
<td>${ls?.boTham?ls.boTham.toLocaleString()+" Ä‘":""}</td>
<td>${ls?.daHot?"ğŸ”¥ ÄÃƒ Há»T":daChet(n)?"â˜  CHÆ¯NG CHáº¾T":"âœ” CHÆ¯NG Sá»NG"}${!ls?.daHot && !daChet(n)?`<br><button class="hot" onclick="hotHui(${i})">Há»‘t</button>`:""}</td>
<td><button class="xoa" onclick="xoaNguoi(${i})">âŒ</button></td>
</tr>`;
    });
    document.getElementById("bang").innerHTML=html;

    let tenNguoiHot="";
    huiData[currentMoney].danhSach.forEach(n=>{
        let ls=n.lichSu[kyHienTai];
        if(ls?.daHot) tenNguoiHot=n.ten;
    });
    document.getElementById("tongHot").innerHTML=huiData[currentMoney].tongHot[kyHienTai]? "ğŸ’° <b>"+tenNguoiHot+"</b> há»‘t: <b>"+huiData[currentMoney].tongHot[kyHienTai].toLocaleString()+" Ä‘</b>":"";  
}

/* ===== XUáº¤T PDF ===== */
function taoDienGiaiPDF(){
    let ky= huiData[currentMoney].ky;
    let tenNguoiHot = huiData[currentMoney].danhSach.find(n=>n.lichSu[ky]?.daHot)?.ten || "ChÆ°a há»‘t";
    let bangNguoi = `<table style="width:100%;border-collapse:collapse;"><thead><tr style="background:#3498db;color:#fff">
<th>TÃªn</th><th>ÄÃ£ Ä‘Ã³ng</th><th>Tiá»n Ä‘Ã³ng</th><th>Bá» thÄƒm</th><th>Tráº¡ng thÃ¡i</th></tr></thead><tbody>`;
    huiData[currentMoney].danhSach.forEach(n=>{
        let ls=n.lichSu[ky];
        let trangThai = ls?.daHot?"ğŸ”¥ Há»T":daChet(n)?"â˜  CHáº¾T":"âœ” Sá»NG";
        let mau = ls?.daHot?"#d4edda":daChet(n)?"#f8d7da":"#ffffff";
        bangNguoi += `<tr style="background:${mau}"><td>${n.ten}</td><td>${ls?.daDong?"âœ”":""}</td><td>${ls?ls.dong.toLocaleString()+" Ä‘":""}</td><td>${ls?.boTham?ls.boTham.toLocaleString()+" Ä‘":""}</td><td>${trangThai}</td></tr>`;
    });
    bangNguoi+="</tbody></table>";

    let tongTien = huiData[currentMoney].danhSach.reduce((acc,n)=>{
        let ls = n.lichSu[ky]; return ls? acc + (ls.daHot?0:ls.dong) : acc;
    },0);
    let thucNhan = tongTien - DAU_THAO;

    return `<div style="margin-top:20px;padding:15px;border:2px dashed #444;font-size:18px;line-height:1.6">
<b>ğŸ“Œ THÃ”NG TIN Há»T Há»¤I â€“ Ká»² ${ky}</b><br><br>
${bangNguoi}
<div style="margin-top:10px;font-weight:bold;color:#000">
NgÆ°á»i há»‘t: ${tenNguoiHot}<br>
Tá»•ng tiá»n há»¥i: ${tongTien.toLocaleString()} Ä‘<br>
Trá»« Ä‘áº§u tháº£o: ${DAU_THAO.toLocaleString()} Ä‘<br>
<b>ğŸ‘‰ Thá»±c nháº­n: ${thucNhan.toLocaleString()} Ä‘</b>
</div></div>`;
}

function thongTinChuHuiQR(){
    let bankId="MB",accountNo="99999250509",accountName="NGUYEN+HANG+NI";
    let qrUrl=`https://img.vietqr.io/image/${bankId}-${accountNo}-compact2.png?accountName=${accountName}`;
    return `<div style="margin-top:30px;padding:15px;border-top:2px solid #000;display:flex;gap:20px;align-items:center;font-size:18px;line-height:1.7">
<img src="${qrUrl}" width="180">
<div><b>ğŸ‘¤ CHá»¦ Há»¤I</b><br>TÃªn: <b>Nguyá»…n Háº±ng Ni</b><br>ğŸ“ SÄT: <b>0947 197 319</b><br>ğŸ¦ NgÃ¢n hÃ ng: <b>MB Bank</b><br>ğŸ’³ STK: <b>99999250509</b></div></div>`;
}

function xuatPDF(){
    // XÃ¡c Ä‘á»‹nh Ä‘áº§u tháº£o theo dÃ¢y há»¥i
    let dauThao;
    if(currentMoney===5000000) dauThao=3000000;
    else if(currentMoney===10000000) dauThao=6000000;
    else if(currentMoney===20000000) dauThao=10000000;
    else dauThao=0;

    let kyHienTai = huiData[currentMoney].ky;

    // TÃªn ngÆ°á»i há»‘t
    let tenNguoiHot = huiData[currentMoney].danhSach.find(n=>n.lichSu[kyHienTai]?.daHot)?.ten || "ChÆ°a há»‘t";

    // Táº¡o báº£ng PDF
    let bangPDF = `
    <table style="width:100%;border-collapse:collapse;">
    <thead>
    <tr style="background:#3498db;color:#fff">
        <th>TÃªn</th>
        <th>ÄÃ£ Ä‘Ã³ng</th>
        <th>Tiá»n Ä‘Ã³ng</th>
        <th>Bá» thÄƒm</th>
        <th>Tráº¡ng thÃ¡i</th>
    </tr>
    </thead>
    <tbody>
    ${huiData[currentMoney].danhSach.map(n=>{
        let ls = n.lichSu[kyHienTai];
        let trangThai = ls?.daHot ? "ğŸ”¥ Há»T Ká»² NÃ€Y" : daChet(n) ? "â˜  CHÆ¯NG CHáº¾T" : "âœ” CHÆ¯NG Sá»NG";
        let mau = ls?.daHot ? "#d4edda" : daChet(n) ? "#f8d7da" : "#ffffff";
        return `<tr style="background:${mau};color:#000">
            <td>${n.ten}</td>
            <td>${ls?.daDong?"âœ”":""}</td>
            <td>${ls?ls.dong.toLocaleString()+" Ä‘":""}</td>
            <td>${ls?.boTham?ls.boTham.toLocaleString()+" Ä‘":""}</td>
            <td>${trangThai}</td>
        </tr>`;
    }).join("")}
    </tbody>
    </table>`;

    // TÃ­nh tá»•ng tiá»n vÃ  thá»±c nháº­n
    let tongTien = huiData[currentMoney].danhSach.reduce((acc,n)=>{
        let ls = n.lichSu[kyHienTai];
        if(ls){
            if(ls.daHot) return acc;
            return acc + ls.dong;
        }
        return acc;
    },0);

    let thucNhan = tongTien - dauThao;

    // QR thanh toÃ¡n vÃ  thÃ´ng tin chá»§ há»¥i
    let bankId = "MB";
    let accountNo = "99999250509";
    let accountName = "NGUYEN+HANG+NI";
    let qrUrl = `https://img.vietqr.io/image/${bankId}-${accountNo}-compact2.png?accountName=${accountName}`;

    // Má»Ÿ PDF má»›i
    let w = window.open("", "_blank");
    w.document.write(`
    <html>
    <head>
    <meta charset="UTF-8">
    <title>Phiáº¿u Há»¥i</title>
    <style>
    body{font-family:Arial;font-size:18px}
    table{width:100%;border-collapse:collapse}
    th,td{border:1px solid #000;padding:8px;text-align:center}
    th{background:#3498db;color:#fff}
    .quayLai{margin-top:30px;padding:15px;border:2px dashed #333;text-align:center}
    .quayLai button{padding:8px 14px;background:#27ae60;color:#fff;border:none;border-radius:5px;cursor:pointer}
    @media print{.quayLai{display:none}}
    </style>
    </head>
    <body>

    <div style="margin-top:20px;padding:15px;border:2px dashed #444;font-size:18px;line-height:1.6">
        <b>ğŸ“Œ THÃ”NG TIN Há»T Há»¤I â€“ Ká»² ${kyHienTai}</b><br><br>
        ${bangPDF}
        <div style="margin-top:10px;font-weight:bold;color:#000">
        NgÆ°á»i há»‘t: ${tenNguoiHot}<br>
        Tá»•ng tiá»n há»¥i: ${tongTien.toLocaleString()} Ä‘<br>
        Trá»« Ä‘áº§u tháº£o: ${dauThao.toLocaleString()} Ä‘<br>
        <b>ğŸ‘‰ Thá»±c nháº­n: ${thucNhan.toLocaleString()} Ä‘</b>
        </div>
    </div>

    <div style="margin-top:30px;padding:15px;border-top:2px solid #000;display:flex;gap:20px;align-items:center;font-size:18px;line-height:1.7">
        <img src="${qrUrl}" width="180">
        <div>
            <b>ğŸ‘¤ CHá»¦ Há»¤I</b><br>
            TÃªn: <b>Nguyá»…n Háº±ng Ni</b><br>
            ğŸ“ SÄT: <b>0947 197 319</b><br>
            ğŸ¦ NgÃ¢n hÃ ng: <b>MB Bank</b><br>
            ğŸ’³ STK: <b>99999250509</b><br>
        </div>
    </div>

    <div class="quayLai">
        ğŸ‘‰ Quay láº¡i Ä‘á»ƒ tiáº¿p tá»¥c dÃ¢y há»¥i / khui ká»³ má»›i<br>
        <button onclick="window.close()">â¬… Quay láº¡i Quáº£n LÃ½ Há»¥i</button>
    </div>

    <script>
      window.onload = function(){ setTimeout(()=>{ window.print(); },500); }
    <\/script>

    </body>
    </html>
    `);
    w.document.close();
}

function resetHui(){ if(!confirm("Reset toÃ n bá»™ dÃ¢y há»¥i?")) return; huiData[currentMoney]={ky:1,ngay:{},tongHot:{},danhSach:[]}; save(); veBang(); }

function render(){ if(huiData[currentMoney]) veBang(); }

</script>
</body>
</html>



